<script>
	const y_init = -2.54
	const y_step = -5.08
	/*! From raw text parse and return array of dictionary with keys: 
	 * index - pin number, 
	 * label - pin name
	 */
	function get_parsed_pins(raw_list){
		const split_regex = new RegExp('^(\\S+)\[\\t\\s\]+(\\S+)$');
		sort_list = []
		pins = raw_list.split("\n")
		
		pins.forEach(function (item, index) {
			if (item.match(split_regex) != null) {
				temp = split_regex.exec(item)
				sort_list.push({"index":temp[1], "label":temp[2]})
			}
		});
		
		return sort_list;
	};
	
	/*!
	 *  Main process for build kicad symbol structure
	 */
	function process(){
		const split_regex = /^(\S*)[\t\s]*(.*)$/gm;
		pins = get_parsed_pins(document.getElementById("pin_list").value);
		symbol_text = ""
		
		// Signal name list
		pos_y = y_init
		pins.forEach(function (item, index) {
			symbol_text += "(text \"" + item["index"] + "\" (at 4.826 " + pos_y.toFixed(3) +" 0)\r\n"
			symbol_text +=  "  (effects (font (size 2 2)))\r\n"
			symbol_text += ")\r\n"	
			pos_y += y_step;
		});
		
		// Connector pins text
		pos_y = y_init
		pins.forEach(function (item, index) {
			symbol_text += "(text \"" + item["label"] + "\" (at -8.89 " + pos_y.toFixed(3) +" 0)\r\n"
			symbol_text += "  (effects (font (size 2 2)))\r\n"
			symbol_text += ")\r\n"	
			pos_y += y_step;
		});
		
		symbol_text += "(text \"Цепь\" (at -10.16 2.54 0)\r\n (effects (font (size 2.0066 2.0066)))\r\n)\r\n"
		
		// Pins
		pos_y = y_init
		pins.forEach(function (item, index) {
			symbol_text += "(pin bidirectional line (at 15.24 " + pos_y.toFixed(3) + " 180) (length 5.08)\r\n"
			symbol_text += "  (name \"" + item["label"] + "\" (effects (font (size 1.27 1.27))))\r\n"
			symbol_text += "  (number \"" + item["index"] + "\" (effects (font (size 1.27 1.27))))\r\n"
			symbol_text += ")\r\n"
			pos_y += y_step;
		});
		
		document.getElementById("output").value = symbol_text;
	};
</script>

<body>
	<h1>Connector symbol generator</h1>
	<div>Place in left textarea list of pin in format "pin_number pin_name" and click on Generate button, take from right textarea text and past it to necesary *.kicad_sym file</div>
	<table>
		<tr>
			<th>Pin list</th>
			<th>Result</th>
		</tr>
		<tr>
			<td><textarea id="pin_list" rows="40" cols="80">12 cool_pin</textarea></td>
			<td><textarea id="output" rows="40" cols="80" readonly></textarea></td>
		</tr>
	</table>
	<div>
		<input type="button" value="Generate" onclick="process()">
	</div>
</body>
